<html>

<head>
  <title>Express</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
</head>
<style>
  html,body{
    padding:0;
    margin:0;
  }
</style>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <h1 class="text-white">BLOG USERS</h1>
    <div class="mr-auto"></div>
    <ul class="text-white navbar-nav">
  
      
      <li class="nav-item">
        <button class="logout btn btn-danger">LogOut</button>
      </li>
    </ul>
  
  </nav>

  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary ml-5 mt-5" data-toggle="modal" data-target="#ADDUSER">
    ADD USER
  </button>
  <div id="users" class="m-5">
  </div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="text" name="id" class="form-control" id="id" placeholder="id" value="0"><br/>
          <input type="text" name="username" class="form-control" id="username" placeholder="username"><br />
          <input type="email" name="email" class="form-control" id="email" placeholder="Email"><br />
          <input type="password" name="passwod" class="form-control" id="password" placeholder="password"><br />
          <input type="text" name="role" class="form-control" id="role" placeholder="role"><br />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary save">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="ADDUSER" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">ADD USER</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input type="text" name="id" class="form-control" id="id_add" placeholder="id"><br />
          <input type="text" name="username" class="form-control" id="username_add" placeholder="username"><br />
          <input type="email" name="email" class="form-control" id="email_add" placeholder="Email"><br />
          <input type="password" name="passwod" class="form-control" id="password_add" placeholder="password"><br />
          <input type="text" name="role" class="form-control" id="role_add" placeholder="role"><br />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary add">Add</button>
        </div>
      </div>
    </div>
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
  integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
  integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
  integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</body>
<script>
  console.log("");
  $(document).ready(function () {
var a;
      refresh_table();
      function refresh_table() {
      if (typeof(localStorage.getItem('token'))=="undefined") {
          window.location.href = "http://localhost:3000/login.html";
        }
      if (!localStorage.getItem('token')) {
          console.log("here");
          window.location.href = "http://localhost:3000/login.html";
        }
      if (localStorage.getItem('role')==="author")
      {
        window.location.href = "http://localhost:3000/articles.html?id=" + localStorage.getItem('id');
      }
      if (localStorage.getItem('role') === "guest") {
          window.location.href = "http://localhost:3000/Allarticles.html";
        }
      fetch('http://localhost:3000/users/admin',{
        method:"POST",
        headers: {
          'x-access-token':localStorage.token,
          'Content-Type': 'application/json'
        },
     
        body: JSON.stringify({ "UserId":localStorage.id})
      })
      .then(response => response.json())
      .then(response =>{
        
        let table="<table class='table table-bordered table-striped'><tr ><th>ID</th><th>USERNAME</th><th>EMAIL</th><th>ROLE</th><th>PASSWORD</th><th>REMOVE</th><th>UPDATE</th></th><th>ARTICLES</th></tr>";
        
        response.forEach(user => {
          table+="<tr><th>"+user["id"]+"</th><th>"+ user["username"] +"</th><th>"+user["email"] +"</th><th>"+user["role"] +"</th><th>"+user["password"] +"</th>";
          table+="<td><button class='btn btn-danger remove' id=" + user["id"] +"> Remove</button ></td>";
          table+="<td><button id="+user["id"]+" type='button' class='btn btn-secondary update' data-toggle='modal' data-target='#exampleModal' >update</button></td>";
          table += "<td><a methode='POST' href='articles.html?id="+user["id"]+"'  class='link-dark'>articles</a></td>";
          table+="</tr>";
        });
        table+="</table>";
        document.getElementById('users').innerHTML = table;
      });
      }

      setInterval(refresh_table, 1000);

    });
  
      $(document).on("click", ".remove", function () {
          var id = $(this).attr("id");
          return fetch('/users/'+id, {
            method: 'delete',
        }).then(response => console.log(response))
          
      });
      $(document).on("click", ".update", function () {
        document.getElementById("id").value=$(this).attr("id");
        console.log($this.attr("id"));
      });
       $(document).on("click", ".save", function () {
          var id = $("#id").val();
          var username = $("#username").val();
          var email = $("#email").val();
          var password = $("#password").val();
          var role = $("#role").val();
          return fetch('/users/users', {
          method: 'PUT',
          dataType:'JSON',
          body: JSON.stringify({ id: id,username:username,email:email,password:password,role:role}),
          headers: {
              "Content-Type": "application/json"
            }
          }).then(response => console.log(response))

        });
        $(document).on("click", ".add", function () {
            var id = $("#id_add").val();
            var username = $("#username_add").val();
            var email = $("#email_add").val();
            var password = $("#password_add").val();
            var role = $("#role_add").val();
            return fetch('http://localhost:3000/users/users', {
              method: 'POST',
              dataType: 'JSON',
              body: JSON.stringify({ id: id, username: username, email: email, password: password, role: role }),
              headers: {
                "Content-Type": "application/json"
              }
            }).then(response => console.log(response))

          });
          $(document).on("click", ".logout", function () {
              localStorage.clear();

              window.location.href = "http://localhost:3000/login.html";
            });
</script>
</html>
